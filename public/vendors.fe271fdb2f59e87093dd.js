"use strict";(self.webpackChunkmemoize=self.webpackChunkmemoize||[]).push([[216],{577:(e,t,r)=>{r.d(t,{eI:()=>createClient});var __awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};class FunctionsError extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class FunctionsFetchError extends FunctionsError{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class FunctionsRelayError extends FunctionsError{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class FunctionsHttpError extends FunctionsError{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var FunctionsClient_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};class FunctionsClient{constructor(e,{headers:t={},customFetch:s}={}){this.url=e,this.headers=t,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>__awaiter(void 0,void 0,void 0,(function*(){return yield(yield Promise.resolve().then(r.t.bind(r,607,23))).fetch(...e)})):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return FunctionsClient_awaiter(this,void 0,void 0,(function*(){try{const{headers:s,method:i,body:n}=t;let o,a={};n&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",o=n):"string"==typeof n?(a["Content-Type"]="text/plain",o=n):"undefined"!=typeof FormData&&n instanceof FormData?o=n:(a["Content-Type"]="application/json",o=JSON.stringify(n)));const l=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:o}).catch((e=>{throw new FunctionsFetchError(e)})),h=l.headers.get("x-relay-error");if(h&&"true"===h)throw new FunctionsRelayError(l);if(!l.ok)throw new FunctionsHttpError(l);let c,u=(null!==(r=l.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return c="application/json"===u?yield l.json():"application/octet-stream"===u?yield l.blob():"multipart/form-data"===u?yield l.formData():yield l.text(),{data:c,error:null}}catch(s){return{data:null,error:s}}}))}}var s=r(607),i=r.n(s),PostgrestBuilder_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};class PostgrestBuilder{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=i():this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((e=>PostgrestBuilder_awaiter(this,void 0,void 0,(function*(){var t,r,s;let i=null,n=null,o=null,a=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=yield e.text();""===t||(n="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const s=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),h=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");s&&h&&h.length>1&&(o=parseInt(h[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(i={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,o=null,a=406,l="Not Acceptable"):n=1===n.length?n[0]:null)}else{const t=yield e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(n=[],i=null,a=200,l="OK")}catch(h){404===e.status&&""===t?(a=204,l="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(s=null==i?void 0:i.details)||void 0===s?void 0:s.includes("Results contain 0 rows"))&&(i=null,a=200,l="OK"),i&&this.shouldThrowOnError)throw i}return{error:i,data:n,count:o,status:a,statusText:l}}))));return this.shouldThrowOnError||(r=r.catch((e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}}))),r.then(e,t)}}class PostgrestTransformBuilder extends PostgrestBuilder{select(e){let t=!1;const r=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s}={}){const i=s?`${s}.order`:"order",n=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=void 0===t?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const s=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:n="text"}={}){const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),a=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${a}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class PostgrestFilterBuilder extends PostgrestTransformBuilder{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";"plain"===s?i="pl":"phrase"===s?i="ph":"websearch"===s&&(i="w");const n=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class PostgrestQueryBuilder{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const n=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e))).join("");return this.url.searchParams.set("select",n),r&&(this.headers.Prefer=`count=${r}`),new PostgrestFilterBuilder({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),r||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new PostgrestFilterBuilder({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const n=[`resolution=${r?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&n.push(this.headers.Prefer),s&&n.push(`count=${s}`),i||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new PostgrestFilterBuilder({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new PostgrestFilterBuilder({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new PostgrestFilterBuilder({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const n={"X-Client-Info":"postgrest-js/1.7.2"};class PostgrestClient{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},n),t),this.schema=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new PostgrestQueryBuilder(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let i;const n=new URL(`${this.url}/rpc/${e}`);let o;r?(i="HEAD",Object.entries(t).forEach((([e,t])=>{n.searchParams.append(e,`${t}`)}))):(i="POST",o=t);const a=Object.assign({},this.headers);return s&&(a.Prefer=`count=${s}`),new PostgrestFilterBuilder({method:i,url:n,headers:a,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}}var o=r(47);const a={"X-Client-Info":"realtime-js/2.7.3"};var l,h,c,u,d,f,p;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(l||(l={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(h||(h={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(c||(c={})),function(e){e.websocket="websocket"}(u||(u={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(d||(d={}));class Timer{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}class Serializer{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let n=this.HEADER_LENGTH+2;const o=r.decode(e.slice(n,n+s));n+=s;const a=r.decode(e.slice(n,n+i));n+=i;return{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(e.slice(n,e.byteLength)))}}}class Push{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0;"rate limited"===this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(f||(f={}));class RealtimePresence{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},(e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,e,t,r),this.pendingDiffs.forEach((e=>{this.state=RealtimePresence.syncDiff(this.state,e,t,r)})),this.pendingDiffs=[],s()})),this.channel._on(r.diff,{},(e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=RealtimePresence.syncDiff(this.state,e,t,r),s())})),this.onJoin(((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})})),this.onLeave(((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,r,s){const i=this.cloneDeep(e),n=this.transformState(t),o={},a={};return this.map(i,((e,t)=>{n[e]||(a[e]=t)})),this.map(n,((e,t)=>{const r=i[e];if(r){const s=t.map((e=>e.presence_ref)),i=r.map((e=>e.presence_ref)),n=t.filter((e=>i.indexOf(e.presence_ref)<0)),l=r.filter((e=>s.indexOf(e.presence_ref)<0));n.length>0&&(o[e]=n),l.length>0&&(a[e]=l)}else o[e]=t})),this.syncDiff(i,{joins:o,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,((t,s)=>{var i;const n=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=this.cloneDeep(s),n.length>0){const r=e[t].map((e=>e.presence_ref)),s=n.filter((e=>r.indexOf(e.presence_ref)<0));e[t].unshift(...s)}r(t,n,s)})),this.map(n,((t,r)=>{let i=e[t];if(!i)return;const n=r.map((e=>e.presence_ref));i=i.filter((e=>n.indexOf(e.presence_ref)<0)),e[t]=i,s(t,i,r),0===i.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((r=>t(r,e[r])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):s,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(p||(p={}));const convertChangeData=(e,t,r={})=>{var s;const i=null!==(s=r.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce(((r,s)=>(r[s]=convertColumn(s,e,t,i),r)),{})},convertColumn=(e,t,r,s)=>{const i=t.find((t=>t.name===e)),n=null==i?void 0:i.type,o=r[e];return n&&!s.includes(n)?convertCell(n,o):noop(o)},convertCell=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return toArray(t,r)}switch(e){case p.bool:return toBoolean(t);case p.float4:case p.float8:case p.int2:case p.int4:case p.int8:case p.numeric:case p.oid:return toNumber(t);case p.json:case p.jsonb:return toJson(t);case p.timestamp:return toTimestampString(t);case p.abstime:case p.date:case p.daterange:case p.int4range:case p.int8range:case p.money:case p.reltime:case p.text:case p.time:case p.timestamptz:case p.timetz:case p.tsrange:case p.tstzrange:default:return noop(t)}},noop=e=>e,toBoolean=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},toNumber=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},toJson=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},toArray=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const n=e.slice(1,r);try{s=JSON.parse("["+n+"]")}catch(i){s=n?n.split(","):[]}return s.map((e=>convertCell(t,e)))}return e},toTimestampString=e=>"string"==typeof e?e.replace(" ","T"):e;var v,y,g,RealtimeChannel_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(v||(v={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes"}(y||(y={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(g||(g={}));class RealtimeChannel{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=h.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,c.join,this.params,this.timeout),this.rejoinTimer=new Timer((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=h.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=h.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=h.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=h.errored,this.rejoinTimer.scheduleTimeout())})),this._on(c.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new RealtimePresence(this)}subscribe(e,t=this.timeout){var r,s;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:n}}=this.params;this._onError((t=>e&&e("CHANNEL_ERROR",t))),this._onClose((()=>e&&e("CLOSED")));const o={},a={broadcast:i,presence:n,postgres_changes:null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map((e=>e.filter)))&&void 0!==s?s:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:a},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(({postgres_changes:t})=>{var r;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==t){const s=this.bindings.postgres_changes,i=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,n=[];for(let r=0;r<i;r++){const i=s[r],{filter:{event:o,schema:a,table:l,filter:h}}=i,c=t&&t[r];if(!c||c.event!==o||c.schema!==a||c.table!==l||c.filter!==h)return this.unsubscribe(),void(e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},i),{id:c.id}))}return this.bindings.postgres_changes=n,void(e&&e("SUBSCRIBED"))}e&&e("SUBSCRIBED")})).receive("error",(t=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{e&&e("TIMED_OUT")}))}return this}presenceState(){return this.presence.state}track(e,t={}){return RealtimeChannel_awaiter(this,void 0,void 0,(function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}))}untrack(e={}){return RealtimeChannel_awaiter(this,void 0,void 0,(function*(){return yield this.send({type:"presence",event:"untrack"},e)}))}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise((r=>{var s,i,n;const o=this._push(e.type,e,t.timeout||this.timeout);o.rateLimited&&r("rate limited"),"broadcast"!==e.type||(null===(n=null===(i=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===i?void 0:i.broadcast)||void 0===n?void 0:n.ack)||r("ok"),o.receive("ok",(()=>r("ok"))),o.receive("timeout",(()=>r("timed out")))}))}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=h.leaving;const onClose=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(c.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((t=>{const r=new Push(this,c.leave,{},e);r.receive("ok",(()=>{onClose(),t("ok")})).receive("timeout",(()=>{onClose(),t("timed out")})).receive("error",(()=>{t("error")})),r.send(),this._canPush()||r.trigger("ok",{})}))}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Push(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const n=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:h}=c;if(r&&[o,a,l,h].indexOf(n)>=0&&r!==this._joinRef())return;let u=this._onMessage(n,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter((e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===n})).map((e=>e.callback(u,r))):null===(i=this.bindings[n])||void 0===i||i.filter((e=>{var r,s,i,o,a,l;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return n&&(null===(s=t.ids)||void 0===s?void 0:s.includes(n))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n})).map((e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:r,commit_timestamp:s,type:i,errors:n}=e,o={schema:t,table:r,commit_timestamp:s,eventType:i,new:{},old:{},errors:n};u=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(u,r)}))}_isClosed(){return this.state===h.closed}_isJoined(){return this.state===h.joined}_isJoining(){return this.state===h.joining}_isLeaving(){return this.state===h.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter((e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&RealtimeChannel.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(c.close,{},e)}_onError(e){this._on(c.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=h.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=convertChangeData(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=convertChangeData(e.columns,e.old_record)),t}}var RealtimeClient_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};const RealtimeClient_noop=()=>{};class RealtimeClient{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=a,this.params={},this.timeout=1e4,this.transport=o.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=RealtimeClient_noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${u.websocket}`,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.transport)&&(this.transport=t.transport),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.eventsPerSecond;s&&(this.eventsPerSecondLimitMs=Math.floor(1e3/s)),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Timer((()=>RealtimeClient_awaiter(this,void 0,void 0,(function*(){this.disconnect(),this.connect()}))),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return RealtimeClient_awaiter(this,void 0,void 0,(function*(){const t=yield e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}))}removeAllChannels(){return RealtimeClient_awaiter(this,void 0,void 0,(function*(){const e=yield Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}))}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case l.connecting:return d.Connecting;case l.open:return d.Open;case l.closing:return d.Closing;default:return d.Closed}}isConnected(){return this.connectionState()===d.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new RealtimeChannel(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e;let callback=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};if(this.log("push",`${t} ${r} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(callback)())return"rate limited"}else callback();else this.sendBuffer.push(callback)}setAuth(e){this.accessToken=e,this.channels.forEach((t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(c.access_token,{access_token:e})}))}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:r,payload:s,ref:i}=e;(i&&i===this.pendingHeartbeatRef||r===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${r} ${i&&"("+i+")"||""}`,s),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(r,s,i))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this._sendHeartbeat()),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(c.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>!!this.inThrottle||(e(),t>0&&(this.inThrottle=!0,setTimeout((()=>{this.inThrottle=!1}),t)),!1)}}class StorageError extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function isStorageError(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class StorageApiError extends StorageError{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class StorageUnknownError extends StorageError{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var helpers_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};const helpers_resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>helpers_awaiter(void 0,void 0,void 0,(function*(){return yield(yield Promise.resolve().then(r.t.bind(r,607,23))).fetch(...e)})):fetch),(...e)=>t(...e)};var fetch_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};const _getErrorMessage=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),handleError=(e,t)=>fetch_awaiter(void 0,void 0,void 0,(function*(){const s=yield helpers_awaiter(void 0,void 0,void 0,(function*(){return"undefined"==typeof Response?(yield Promise.resolve().then(r.t.bind(r,607,23))).Response:Response}));e instanceof s?e.json().then((r=>{t(new StorageApiError(_getErrorMessage(r),e.status||500))})).catch((e=>{t(new StorageUnknownError(_getErrorMessage(e),e))})):t(new StorageUnknownError(_getErrorMessage(e),e))})),_getRequestParams=(e,t,r,s)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),r))};function _handleRequest(e,t,r,s,i,n){return fetch_awaiter(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{e(r,_getRequestParams(t,s,i,n)).then((e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()})).then((e=>o(e))).catch((e=>handleError(e,a)))}))}))}function get(e,t,r,s){return fetch_awaiter(this,void 0,void 0,(function*(){return _handleRequest(e,"GET",t,r,s)}))}function post(e,t,r,s,i){return fetch_awaiter(this,void 0,void 0,(function*(){return _handleRequest(e,"POST",t,s,i,r)}))}function remove(e,t,r,s,i){return fetch_awaiter(this,void 0,void 0,(function*(){return _handleRequest(e,"DELETE",t,s,i,r)}))}var StorageFileApi_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};const m={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class StorageFileApi{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=helpers_resolveFetch(s)}uploadOrUpdate(e,t,r,s){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){try{let i;const n=Object.assign(Object.assign({},_),s),o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(i=new FormData,i.append("cacheControl",n.cacheControl),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(i=r,i.append("cacheControl",n.cacheControl)):(i=r,o["cache-control"]=`max-age=${n.cacheControl}`,o["content-type"]=n.contentType);const a=this._removeEmptyFolders(t),l=this._getFinalPath(a),h=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:i,headers:o},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{}));if(h.ok)return{data:{path:a},error:null};return{data:null,error:yield h.json()}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}}))}upload(e,t,r){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,r)}))}uploadToSignedUrl(e,t,r,s){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){const i=this._removeEmptyFolders(e),n=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${n}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:_.upsert},s),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType);const a=yield this.fetch(o.toString(),{method:"PUT",body:e,headers:n});if(a.ok)return{data:{path:i},error:null};return{data:null,error:yield a.json()}}catch(a){if(isStorageError(a))return{data:null,error:a};throw a}}))}createSignedUploadUrl(e){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){try{let t=this._getFinalPath(e);const r=yield post(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new StorageError("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}}))}update(e,t,r){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,r)}))}move(e,t){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){try{return{data:yield post(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(isStorageError(r))return{data:null,error:r};throw r}}))}copy(e,t){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){try{return{data:{path:(yield post(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(isStorageError(r))return{data:null,error:r};throw r}}))}createSignedUrl(e,t,r){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e),i=yield post(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${n}`)},{data:i,error:null}}catch(s){if(isStorageError(s))return{data:null,error:s};throw s}}))}createSignedUrls(e,t,r){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){try{const s=yield post(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${i}`):null}))),error:null}}catch(s){if(isStorageError(s))return{data:null,error:s};throw s}}))}download(e,t){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield get(this.fetch,`${this.url}/${r}/${t}${i}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}}))}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==i&&s.push(i);const n=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${r}${a}`)}}}remove(e){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){try{return{data:yield remove(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}}))}list(e,t,r){return StorageFileApi_awaiter(this,void 0,void 0,(function*(){try{const s=Object.assign(Object.assign(Object.assign({},m),t),{prefix:e||""});return{data:yield post(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(isStorageError(s))return{data:null,error:s};throw s}}))}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const b={"X-Client-Info":"storage-js/2.5.1"};var StorageBucketApi_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};class StorageBucketApi{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},b),t),this.fetch=helpers_resolveFetch(r)}listBuckets(){return StorageBucketApi_awaiter(this,void 0,void 0,(function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(isStorageError(e))return{data:null,error:e};throw e}}))}getBucket(e){return StorageBucketApi_awaiter(this,void 0,void 0,(function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}}))}createBucket(e,t={public:!1}){return StorageBucketApi_awaiter(this,void 0,void 0,(function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(isStorageError(r))return{data:null,error:r};throw r}}))}updateBucket(e,t){return StorageBucketApi_awaiter(this,void 0,void 0,(function*(){try{const r=yield function put(e,t,r,s,i){return fetch_awaiter(this,void 0,void 0,(function*(){return _handleRequest(e,"PUT",t,s,i,r)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:r,error:null}}catch(r){if(isStorageError(r))return{data:null,error:r};throw r}}))}emptyBucket(e){return StorageBucketApi_awaiter(this,void 0,void 0,(function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}}))}deleteBucket(e){return StorageBucketApi_awaiter(this,void 0,void 0,(function*(){try{return{data:yield remove(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}}))}}class StorageClient extends StorageBucketApi{constructor(e,t={},r){super(e,t,r)}from(e){return new StorageFileApi(this.url,this.headers,e,this.fetch)}}const w={"X-Client-Info":"supabase-js/2.31.0"};var lib_fetch_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};const fetch_resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?i():fetch),(...e)=>t(...e)},fetchWithAuth=(e,t,r)=>{const i=fetch_resolveFetch(r),n="undefined"==typeof Headers?s.Headers:Headers;return(r,s)=>lib_fetch_awaiter(void 0,void 0,void 0,(function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new n(null==s?void 0:s.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),i(r,Object.assign(Object.assign({},s),{headers:l}))}))};var lib_helpers_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};const helpers_isBrowser=()=>"undefined"!=typeof document,E={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!helpers_isBrowser())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(E.tested)return E.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),E.tested=!0,E.writable=!0}catch(t){E.tested=!0,E.writable=!1}return E.writable};function parseParametersFromURL(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach(((e,r)=>{t[r]=e}))}catch(s){}return r.searchParams.forEach(((e,r)=>{t[r]=e})),t}const lib_helpers_resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>lib_helpers_awaiter(void 0,void 0,void 0,(function*(){return yield(yield Promise.resolve().then(r.t.bind(r,607,23))).fetch(...e)})):fetch),(...e)=>t(...e)},looksLikeFetchResponse=e=>"object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json,setItemAsync=(e,t,r)=>lib_helpers_awaiter(void 0,void 0,void 0,(function*(){yield e.setItem(t,JSON.stringify(r))})),getItemAsync=(e,t)=>lib_helpers_awaiter(void 0,void 0,void 0,(function*(){const r=yield e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(s){return r}})),removeItemAsync=(e,t)=>lib_helpers_awaiter(void 0,void 0,void 0,(function*(){yield e.removeItem(t)}));class Deferred{constructor(){this.promise=new Deferred.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function decodeJWTPayload(e){const t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(function decodeBase64URL(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r,s,i,n,o,a,l,h="",c=0;for(e=e.replace("-","+").replace("_","/");c<e.length;)n=t.indexOf(e.charAt(c++)),o=t.indexOf(e.charAt(c++)),a=t.indexOf(e.charAt(c++)),l=t.indexOf(e.charAt(c++)),r=n<<2|o>>4,s=(15&o)<<4|a>>2,i=(3&a)<<6|l,h+=String.fromCharCode(r),64!=a&&0!=s&&(h+=String.fromCharCode(s)),64!=l&&0!=i&&(h+=String.fromCharCode(i));return h}(r))}function sleep(e){return lib_helpers_awaiter(this,void 0,void 0,(function*(){return yield new Promise((t=>{setTimeout((()=>t(null)),e)}))}))}function dec2hex(e){return("0"+e.toString(16)).substr(-2)}function generatePKCEVerifier(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,dec2hex).join("")}function generatePKCEChallenge(e){return lib_helpers_awaiter(this,void 0,void 0,(function*(){if("undefined"==typeof crypto)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;return function base64urlencode(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(yield function sha256(e){return lib_helpers_awaiter(this,void 0,void 0,(function*(){const t=(new TextEncoder).encode(e),r=yield crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map((e=>String.fromCharCode(e))).join("")}))}(e))}))}Deferred.promiseConstructor=Promise;const S=/__stack_guard__([a-zA-Z0-9_-]+)__/;let k,T=!1,A=!1;function isInStackGuard(e){var t,r;let s;k();try{throw new Error}catch(n){s=n}const i=null!==(r=null===(t=s.stack)||void 0===t?void 0:t.split("\n"))&&void 0!==r?r:[];for(let o=0;o<i.length;o+=1){const t=i[o].match(S);if(t&&t[1]===e)return!0}return!1}function stackGuard(e,t){return lib_helpers_awaiter(this,void 0,void 0,(function*(){yield k();const r=`__stack_guard__${e}__`,s={[r]:()=>lib_helpers_awaiter(this,void 0,void 0,(function*(){return yield t()}))};return Object.assign(s[r],{displayName:r}),yield s[r]()}))}function stackGuardsSupported(){return lib_helpers_awaiter(this,void 0,void 0,(function*(){return T||(yield k()),A}))}let j=!1;k=()=>lib_helpers_awaiter(void 0,void 0,void 0,(function*(){T||(T=!0,yield stackGuard("ENV_CHECK",(()=>lib_helpers_awaiter(void 0,void 0,void 0,(function*(){yield sleep(0);const e=isInStackGuard("ENV_CHECK");return A=e,e||j||(j=!0,console.warn("@supabase/gotrue-js: Stack guards not supported in this environment. Generally not an issue but may point to a very conservative transpilation environment (use ES2017 or above) that implements async/await with generators, or this is a JavaScript engine that does not support async/await stack traces. Safari is known to not support stack guards.")),e})))))}));class AuthError extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function isAuthError(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class AuthApiError extends AuthError{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class AuthUnknownError extends AuthError{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class CustomAuthError extends AuthError{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthRetryableFetchError extends CustomAuthError{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function isAuthRetryableFetchError(e){return isAuthError(e)&&"AuthRetryableFetchError"===e.name}var module_lib_fetch_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))},__rest=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(r[s[i]]=e[s[i]])}return r};const fetch_getErrorMessage=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),P=[502,503,504];function fetch_handleError(e){return module_lib_fetch_awaiter(this,void 0,void 0,(function*(){if(!looksLikeFetchResponse(e))throw new AuthRetryableFetchError(fetch_getErrorMessage(e),0);if(P.includes(e.status))throw new AuthRetryableFetchError(fetch_getErrorMessage(e),e.status);let t;try{t=yield e.json()}catch(r){throw new AuthUnknownError(fetch_getErrorMessage(r),r)}throw new AuthApiError(fetch_getErrorMessage(t),e.status||500)}))}const fetch_getRequestParams=(e,t,r,s)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),r))};function _request(e,t,r,s){return module_lib_fetch_awaiter(this,void 0,void 0,(function*(){var i;const n=Object.assign({},null==s?void 0:s.headers);(null==s?void 0:s.jwt)&&(n.Authorization=`Bearer ${s.jwt}`);const o=null!==(i=null==s?void 0:s.query)&&void 0!==i?i:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield function fetch_handleRequest(e,t,r,s,i,n){return module_lib_fetch_awaiter(this,void 0,void 0,(function*(){const o=fetch_getRequestParams(t,s,i,n);let a;try{a=yield e(r,o)}catch(l){throw console.error(l),new AuthRetryableFetchError(fetch_getErrorMessage(l),0)}if(a.ok||(yield fetch_handleError(a)),null==s?void 0:s.noResolveJson)return a;try{return yield a.json()}catch(l){yield fetch_handleError(l)}}))}(e,t,r+a,{headers:n,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}))}function _sessionResponse(e){var t;let r=null;(function hasSession(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),r.expires_at=function expiresAt(e){return Math.round(Date.now()/1e3)+e}(e.expires_in));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function _userResponse(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function _ssoResponse(e){return{data:e,error:null}}function _generateLinkResponse(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:i,verification_type:n}=e,o=__rest(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:i,verification_type:n},user:Object.assign({},o)},error:null}}function _noResolveJsonResponse(e){return e}var GoTrueAdminApi_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))},GoTrueAdminApi_rest=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(r[s[i]]=e[s[i]])}return r};class GoTrueAdminApi{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=lib_helpers_resolveFetch(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e,t="global"){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{return yield _request(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(isAuthError(r))return{data:null,error:r};throw r}}))}inviteUserByEmail(e,t={}){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{return yield _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:_userResponse})}catch(r){if(isAuthError(r))return{data:{user:null},error:r};throw r}}))}generateLink(e){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{const{options:t}=e,r=GoTrueAdminApi_rest(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),yield _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:_generateLinkResponse,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(isAuthError(t))return{data:{properties:null,user:null},error:t};throw t}}))}createUser(e){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{return yield _request(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_userResponse})}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}))}listUsers(e){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){var t,r,s,i,n,o,a;try{const l={nextPage:null,lastPage:0,total:0},h=yield _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(i=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==i?i:""},xform:_noResolveJsonResponse});if(h.error)throw h.error;const c=yield h.json(),u=null!==(n=h.headers.get("x-total-count"))&&void 0!==n?n:0,d=null!==(a=null===(o=h.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t})),l.total=parseInt(u)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(l){if(isAuthError(l))return{data:{users:[]},error:l};throw l}}))}getUserById(e){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{return yield _request(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_userResponse})}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}))}updateUserById(e,t){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{return yield _request(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:_userResponse})}catch(r){if(isAuthError(r))return{data:{user:null},error:r};throw r}}))}deleteUser(e,t=!1){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{return yield _request(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:_userResponse})}catch(r){if(isAuthError(r))return{data:{user:null},error:r};throw r}}))}_listFactors(e){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{const{data:t,error:r}=yield _request(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}))}_deleteFactor(e){return GoTrueAdminApi_awaiter(this,void 0,void 0,(function*(){try{return{data:yield _request(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}))}}const R="2.46.1",O={"X-Client-Info":`gotrue-js/${R}`},C={getItem:e=>supportsLocalStorage()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{supportsLocalStorage()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{supportsLocalStorage()&&globalThis.localStorage.removeItem(e)}};var GoTrueClient_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};!function polyfillGlobalThis(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const x={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:O,flowType:"implicit",debug:!1},$=3e4;function lockNoOp(e,t,r){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield r()}))}class GoTrueClient{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=GoTrueClient.nextInstanceID,GoTrueClient.nextInstanceID+=1,this.instanceID>0&&helpers_isBrowser()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},x),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||C,this.admin=new GoTrueAdminApi({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=lib_helpers_resolveFetch(r.fetch),this.lock=r.lock||lockNoOp,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===C&&!supportsLocalStorage()&&console.warn("No storage option exists to persist the session, which may result in unexpected behavior when using auth.\n        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning."),helpers_isBrowser()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}null===(t=this.broadcastChannel)||void 0===t||t.addEventListener("message",(e=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug("received broadcast notification from other tab or client",e),yield this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))))}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} (${R}) ${(new Date).toISOString()}`,...e),this}initialize(){return this.initializePromise?this.initializePromise:this._initialize()}_initialize(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){if(this.initializePromise)throw new Error("Double call of #_initialize()");return this.initializePromise=this._acquireLock(-1,(()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield stackGuard("_initialize",(()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{const e=!!helpers_isBrowser()&&(yield this._isPKCEFlow());if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=yield this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),yield this._removeSession(),{error:r};const{session:s,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),yield this._saveSession(s),setTimeout((()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){"recovery"===i?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",s):yield this._notifyAllSubscribers("SIGNED_IN",s)}))),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return isAuthError(e)?{error:e}:{error:new AuthUnknownError("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}}))))})))),yield this.initializePromise}))}signUp(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){var t,r,s;try{let i;if(yield this._removeSession(),"email"in e){const{email:r,password:s,options:n}=e;let o=null,a=null;if("pkce"===this.flowType){const e=generatePKCEVerifier();yield setItemAsync(this.storage,`${this.storageKey}-code-verifier`,e),o=yield generatePKCEChallenge(e),a=e===o?"plain":"s256"}i=yield _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:o,code_challenge_method:a},xform:_sessionResponse})}else{if(!("phone"in e))throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:o}=e;i=yield _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:_sessionResponse})}}const{data:n,error:o}=i;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,l=n.user;return n.session&&(yield this._saveSession(n.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(isAuthError(i))return{data:{user:null,session:null},error:i};throw i}}))}signInWithPassword(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{let t;if(yield this._removeSession(),"email"in e){const{email:r,password:s,options:i}=e;t=yield _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:_sessionResponse})}else{if(!("phone"in e))throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:i}=e;t=yield _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:_sessionResponse})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s}):{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}))}signInWithOAuth(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){var t,r,s,i;return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect})}))}exchangeCodeForSession(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){const t=yield getItemAsync(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=yield _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:_sessionResponse});return yield removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s}):{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}}))}signInWithIdToken(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){yield this._removeSession();try{const{options:t,provider:r,token:s,access_token:i,nonce:n}=e,o=yield _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:_sessionResponse}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}))}signInWithOtp(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){var t,r,s,i,n;try{if(yield this._removeSession(),"email"in e){const{email:s,options:i}=e;let n=null,o=null;if("pkce"===this.flowType){const e=generatePKCEVerifier();yield setItemAsync(this.storage,`${this.storageKey}-code-verifier`,e),n=yield generatePKCEChallenge(e),o=e===n?"plain":"s256"}const{error:a}=yield _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},create_user:null===(r=null==i?void 0:i.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:o},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:a}=yield _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(i=null==r?void 0:r.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(n=null==r?void 0:r.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(o){if(isAuthError(o))return{data:{user:null,session:null},error:o};throw o}}))}verifyOtp(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){var t,r;try{let s,i;"email_change"!==e.type&&"phone_change"!==e.type&&(yield this._removeSession()),"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,i=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:n,error:o}=yield _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:_sessionResponse});if(o)throw o;if(!n)throw new Error("An error occurred on token verification.");const a=n.session,l=n.user;return(null==a?void 0:a.access_token)&&(yield this._saveSession(a),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(isAuthError(s))return{data:{user:null,session:null},error:s};throw s}}))}signInWithSSO(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){var t,r,s;try{return yield this._removeSession(),yield _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:_ssoResponse})}catch(i){if(isAuthError(i))return{data:null,error:i};throw i}}))}reauthenticate(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{return yield this._useSession((e=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new AuthSessionMissingError;const{error:s}=yield _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}}))))}catch(e){if(isAuthError(e))return{data:{user:null,session:null},error:e};throw e}}))}resend(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{"email_change"!=e.type&&"phone_change"!=e.type&&(yield this._removeSession());const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:n}=yield _request(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:r,type:s,options:i}=e,{data:n,error:o}=yield _request(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}))}getSession(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){return this._useSession((e=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){return e}))))}))}_acquireLock(e,t){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug("#_acquireLock","begin",e);try{return(yield stackGuardsSupported())?isInStackGuard("_acquireLock")?(this._debug("#_acquireLock","recursive call"),yield t()):yield this.lock(`lock:${this.storageKey}`,e,(()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{return yield stackGuard("_acquireLock",(()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield t()}))))}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey)}})))):(this._debug("#_acquireLock","Stack guards not supported, so exclusive locking is not performed as it can lead to deadlocks if the lock is attempted to be recursively acquired (as the recursion cannot be detected)."),yield t())}finally{this._debug("#_acquireLock","end")}}))}_useSession(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug("#_useSession","begin");try{if(isInStackGuard("_useSession")){this._debug("#_useSession","recursive call");const t=yield this.__loadSession();return yield e(t)}return yield this._acquireLock(-1,(()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield stackGuard("_useSession",(()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){const t=yield this.__loadSession();return yield e(t)}))))}))))}finally{this._debug("#_useSession","end")}}))}__loadSession(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){if(this._debug("#__loadSession()","begin"),this.logDebugMessages&&!isInStackGuard("_useSession")&&(yield stackGuardsSupported()))throw new Error("Please use #_useSession()");isInStackGuard("_initialize")&&this._debug("#__loadSession","#_initialize recursion detected",(new Error).stack),yield this.initializePromise;try{let e=null;if(this.persistSession){const t=yield getItemAsync(this.storage,this.storageKey);this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}))}getUser(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{return e?yield _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_userResponse}):yield this._useSession((e=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var t,r;const{data:s,error:i}=e;if(i)throw i;return yield _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(t=s.session)||void 0===t?void 0:t.access_token)&&void 0!==r?r:void 0,xform:_userResponse})}))))}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}))}updateUser(e,t={}){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{return yield this._useSession((r=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new AuthSessionMissingError;const n=s.session,{data:o,error:a}=yield _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:e,jwt:n.access_token,xform:_userResponse});if(a)throw a;return n.user=o.user,yield this._saveSession(n),yield this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}}))))}catch(r){if(isAuthError(r))return{data:{user:null},error:r};throw r}}))}_decodeJWT(e){return decodeJWTPayload(e)}setSession(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{if(!e.access_token||!e.refresh_token)throw new AuthSessionMissingError;const t=Date.now()/1e3;let r=t,s=!0,i=null;const n=decodeJWTPayload(e.access_token);if(n.exp&&(r=n.exp,s=r<=t),s){const{session:t,error:r}=yield this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};i=t}else{const{data:s,error:n}=yield this.getUser(e.access_token);if(n)throw n;i={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(i),yield this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(isAuthError(t))return{data:{session:null,user:null},error:t};throw t}}))}refreshSession(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{return yield this._useSession((t=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var r;if(!e){const{data:s,error:i}=t;if(i)throw i;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new AuthSessionMissingError;const{session:s,error:i}=yield this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}}))))}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}))}_getSessionFromURL(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{if(!helpers_isBrowser())throw new AuthImplicitGrantRedirectError("No browser detected.");if("implicit"===this.flowType&&!this._isImplicitGrantFlow())throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");if("pkce"==this.flowType&&!e)throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");const t=parseParametersFromURL(window.location.href);if(e){if(!t.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:e,error:r}=yield this.exchangeCodeForSession(t.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:e.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new AuthImplicitGrantRedirectError(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:n,expires_in:o,token_type:a}=t;if(!(i&&o&&n&&a))throw new AuthImplicitGrantRedirectError("No session defined in URL");const l=Math.round(Date.now()/1e3),h=parseInt(o),c=l+h,{data:u,error:d}=yield this.getUser(i);if(d)throw d;const f={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:c,refresh_token:n,token_type:a,user:u.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:f,redirectType:t.type},error:null}}catch(t){if(isAuthError(t))return{data:{session:null,redirectType:null},error:t};throw t}}))}_isImplicitGrantFlow(){const e=parseParametersFromURL(window.location.href);return!(!helpers_isBrowser()||!e.access_token&&!e.error_description)}_isPKCEFlow(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){const e=parseParametersFromURL(window.location.href),t=yield getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}))}signOut({scope:e}={scope:"global"}){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield this._useSession((t=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var r;const{data:s,error:i}=t;if(i)return{error:i};const n=null===(r=s.session)||void 0===r?void 0:r.access_token;if(n){const{error:t}=yield this.admin.signOut(n,e);if(t&&(!function isAuthApiError(e){return isAuthError(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status))return{error:t}}return"others"!==e&&(yield this._removeSession(),yield removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}}))))}))}onAuthStateChange(e){const t=function helpers_uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}_emitInitialSession(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield this._useSession((t=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var r,s;try{const{data:{session:s},error:i}=t;if(i)throw i;yield null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(i){yield null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}}))))}))}resetPasswordForEmail(e,t={}){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){let r=null,s=null;if("pkce"===this.flowType){const e=generatePKCEVerifier();yield setItemAsync(this.storage,`${this.storageKey}-code-verifier`,e),r=yield generatePKCEChallenge(e),s=e===r?"plain":"s256"}try{return yield _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(isAuthError(i))return{data:null,error:i};throw i}}))}_refreshAccessToken(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield function retryable(e,t){return new Promise(((r,s)=>{(()=>{lib_helpers_awaiter(this,void 0,void 0,(function*(){for(let n=0;n<1/0;n++)try{const s=yield e(n);if(!t(n,null,s))return void r(s)}catch(i){if(!t(n,i))return void s(i)}}))})()}))}((r=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield sleep(200*r),this._debug(t,"refreshing attempt",r),yield _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_sessionResponse})}))),((e,t,s)=>s&&s.error&&isAuthRetryableFetchError(s.error)&&Date.now()+200*(e+1)-r<$))}catch(r){if(this._debug(t,"error",r),isAuthError(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}))}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){const r=yield this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),helpers_isBrowser()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}))}_recoverAndRefresh(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=yield getItemAsync(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r))return this._debug(t,"session is not valid"),void(null!==r&&(yield this._removeSession()));const s=Math.round(Date.now()/1e3),i=(null!==(e=r.expires_at)&&void 0!==e?e:1/0)<s+10;if(this._debug(t,`session has${i?"":" not"} expired with margin of 10s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=yield this._callRefreshToken(r.refresh_token);e&&(console.error(e),isAuthRetryableFetchError(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){return this._debug(t,"error",r),void console.error(r)}finally{this._debug(t,"end")}}))}_callRefreshToken(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){var t,r;if(!e)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Deferred;const{data:t,error:r}=yield this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new AuthSessionMissingError;yield this._saveSession(t.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(i){if(this._debug(s,"error",i),isAuthError(i)){const e={session:null,error:i};return null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}))}_notifyAllSubscribers(e,t,r=!0){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],i=Array.from(this.stateChangeEmitters.values()).map((r=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{yield r.callback(e,t)}catch(i){s.push(i)}}))));if(yield Promise.all(i),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}))}_saveSession(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&(yield this._persistSession(e))}))}_persistSession(e){return this._debug("#_persistSession()",e),setItemAsync(this.storage,this.storageKey,e)}_removeSession(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug("#_removeSession()"),this.persistSession?yield removeItemAsync(this.storage,this.storageKey):this.inMemorySession=null}))}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&helpers_isBrowser()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),$);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}))),0)}))}_stopAutoRefresh(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}))}startAutoRefresh(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()}))}stopAutoRefresh(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()}))}_autoRefreshTokenTick(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug("#_autoRefreshTokenTick()","begin");try{const t=Date.now();try{return yield this._useSession((e=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-t)/$);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&(yield this._callRefreshToken(r.refresh_token))}))))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}_handleVisibilityChange(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){if(this._debug("#_handleVisibilityChange()"),!helpers_isBrowser()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield this._onVisibilityChanged(!1)})),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}))}_onVisibilityChanged(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),"visible"===document.visibilityState?setTimeout((()=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){e||(yield this.initializePromise,yield this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()}))),0):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}))}_getUrlForProvider(e,t){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){const r=[`provider=${encodeURIComponent(e)}`];if((null==t?void 0:t.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),(null==t?void 0:t.scopes)&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),"pkce"===this.flowType){const e=generatePKCEVerifier();yield setItemAsync(this.storage,`${this.storageKey}-code-verifier`,e);const t=yield generatePKCEChallenge(e),s=e===t?"plain":"s256";this._debug("PKCE","code verifier",`${e.substring(0,5)}...`,"code challenge",t,"method",s);const i=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(s)}`});r.push(i.toString())}if(null==t?void 0:t.queryParams){const e=new URLSearchParams(t.queryParams);r.push(e.toString())}return`${this.url}/authorize?${r.join("&")}`}))}_unenroll(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{return yield this._useSession((t=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var r;const{data:s,error:i}=t;return i?{data:null,error:i}:yield _request(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})}))))}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}))}_enroll(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{return yield this._useSession((t=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var r,s;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:a}=yield _request(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:null===(r=null==i?void 0:i.session)||void 0===r?void 0:r.access_token});return a?{data:null,error:a}:((null===(s=null==o?void 0:o.totp)||void 0===s?void 0:s.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))))}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}))}_verify(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{return yield this._useSession((t=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:n,error:o}=yield _request(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:o})}))))}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}))}_challenge(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){try{return yield this._useSession((t=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var r;const{data:s,error:i}=t;return i?{data:null,error:i}:yield _request(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})}))))}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}))}_challengeAndVerify(e){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}))}_listFactors(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter((e=>"totp"===e.factor_type&&"verified"===e.status));return{data:{all:r,totp:s},error:null}}))}_getAuthenticatorAssuranceLevel(){return GoTrueClient_awaiter(this,void 0,void 0,(function*(){return yield this._useSession((e=>GoTrueClient_awaiter(this,void 0,void 0,(function*(){var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const n=this._decodeJWT(s.access_token);let o=null;n.aal&&(o=n.aal);let a=o;(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==r?r:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:n.amr||[]},error:null}}))))}))}}GoTrueClient.nextInstanceID=0;!globalThis||!globalThis.localStorage||globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug");class SupabaseAuthClient extends GoTrueClient{constructor(e){super(e)}}var SupabaseClient_awaiter=function(e,t,r,s){return new(r||(r=Promise))((function(i,n){function fulfilled(e){try{step(s.next(e))}catch(t){n(t)}}function rejected(e){try{step(s.throw(e))}catch(t){n(t)}}function step(e){e.done?i(e.value):function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())}))};const I={headers:w},U={schema:"public"},L={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},D={};class SupabaseClient{constructor(e,t,r){var s,i,n,o,a,l,h,c;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const u=function stripTrailingSlash(e){return e.replace(/\/$/,"")}(e);this.realtimeUrl=`${u}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${u}/auth/v1`,this.storageUrl=`${u}/storage/v1`,this.functionsUrl=`${u}/functions/v1`;const d=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,f=function applySettingDefaults(e,t){const{db:r,auth:s,realtime:i,global:n}=e,{db:o,auth:a,realtime:l,global:h}=t;return{db:Object.assign(Object.assign({},o),r),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},h),n)}}(null!=r?r:{},{db:U,realtime:D,auth:Object.assign(Object.assign({},L),{storageKey:d}),global:I});this.storageKey=null!==(i=null===(s=f.auth)||void 0===s?void 0:s.storageKey)&&void 0!==i?i:"",this.headers=null!==(o=null===(n=f.global)||void 0===n?void 0:n.headers)&&void 0!==o?o:{},this.auth=this._initSupabaseAuthClient(null!==(a=f.auth)&&void 0!==a?a:{},this.headers,null===(l=f.global)||void 0===l?void 0:l.fetch),this.fetch=fetchWithAuth(t,this._getAccessToken.bind(this),null===(h=f.global)||void 0===h?void 0:h.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new PostgrestClient(`${u}/rest/v1`,{headers:this.headers,schema:null===(c=f.db)||void 0===c?void 0:c.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new StorageClient(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return SupabaseClient_awaiter(this,void 0,void 0,(function*(){const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:n,debug:o},a,l){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl,headers:Object.assign(Object.assign({},h),a),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:n,debug:o,fetch:l})}_initRealtimeClient(e){return new RealtimeClient(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=r?r:null),this.changedAccessToken=r)}}const createClient=(e,t,r)=>new SupabaseClient(e,t,r)},607:function(e,t){var r="undefined"!=typeof self?self:this,s=function(){function F(){this.fetch=!1,this.DOMException=r.DOMException}return F.prototype=r,new F}();!function(e){!function(t){var r="URLSearchParams"in e,s="Symbol"in e&&"iterator"in Symbol,i="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),n="FormData"in e,o="ArrayBuffer"in e;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function normalizeName(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function normalizeValue(e){return"string"!=typeof e&&(e=String(e)),e}function iteratorFor(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s&&(t[Symbol.iterator]=function(){return t}),t}function Headers(e){this.map={},e instanceof Headers?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function consumed(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function fileReaderReady(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function readBlobAsArrayBuffer(e){var t=new FileReader,r=fileReaderReady(t);return t.readAsArrayBuffer(e),r}function bufferClone(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():o&&i&&function isDataView(e){return e&&DataView.prototype.isPrototypeOf(e)}(e)?(this._bodyArrayBuffer=bufferClone(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=bufferClone(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?consumed(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return function readBlobAsText(e){var t=new FileReader,r=fileReaderReady(t);return t.readAsText(e),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function readArrayBufferAsText(e){for(var t=new Uint8Array(e),r=new Array(t.length),s=0;s<t.length;s++)r[s]=String.fromCharCode(t[s]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers.prototype.append=function(e,t){e=normalizeName(e),t=normalizeValue(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},Headers.prototype.delete=function(e){delete this.map[normalizeName(e)]},Headers.prototype.get=function(e){return e=normalizeName(e),this.has(e)?this.map[e]:null},Headers.prototype.has=function(e){return this.map.hasOwnProperty(normalizeName(e))},Headers.prototype.set=function(e,t){this.map[normalizeName(e)]=normalizeValue(t)},Headers.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},Headers.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),iteratorFor(e)},Headers.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),iteratorFor(e)},Headers.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),iteratorFor(e)},s&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var h=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Request(e,t){var r=(t=t||{}).body;if(e instanceof Request){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Headers(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new Headers(t.headers)),this.method=function normalizeMethod(e){var t=e.toUpperCase();return h.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function decode(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),s=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(i))}})),t}function Response(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new Headers(t.headers),this.url=t.url||"",this._initBody(e)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var e=new Response(null,{status:0,statusText:""});return e.type="error",e};var c=[301,302,303,307,308];Response.redirect=function(e,t){if(-1===c.indexOf(t))throw new RangeError("Invalid status code");return new Response(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(u){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function fetch(e,r){return new Promise((function(s,n){var o=new Request(e,r);if(o.signal&&o.signal.aborted)return n(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function abortXhr(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new Headers,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),s=r.shift().trim();if(s){var i=r.join(":").trim();t.append(s,i)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;s(new Response(i,r))},a.onerror=function(){n(new TypeError("Network request failed"))},a.ontimeout=function(){n(new TypeError("Network request failed"))},a.onabort=function(){n(new t.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&i&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",abortXhr),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",abortXhr)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}fetch.polyfill=!0,e.fetch||(e.fetch=fetch,e.Headers=Headers,e.Request=Request,e.Response=Response),t.Headers=Headers,t.Request=Request,t.Response=Response,t.fetch=fetch,Object.defineProperty(t,"__esModule",{value:!0})}({})}(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var i=s;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t},47:(e,t,r)=>{var s;if("object"==typeof globalThis)s=globalThis;else try{s=r(966)}catch(o){}finally{if(s||"undefined"==typeof window||(s=window),!s)throw new Error("Could not determine global this")}var i=s.WebSocket||s.MozWebSocket,n=r(695);function W3CWebSocket(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(W3CWebSocket,e,{get:function(){return i[e]}})})),e.exports={w3cwebsocket:i?W3CWebSocket:null,version:n}},695:(e,t,r)=>{e.exports=r(620).version},966:e=>{var naiveFallback=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return naiveFallback()}try{return __global__||naiveFallback()}finally{delete Object.prototype.__global__}}()},620:e=>{e.exports={version:"1.0.34"}}}]);